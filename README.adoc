= Professionelle Softwareentwicklung: √úbung 6
:icons: font
:icon-set: fa
:source-highlighter: rouge
:experimental:
ifdef::env-github[]
:tip-caption: :bulb:
:note-caption: :information_source:
:important-caption: :heavy_exclamation_mark:
:caution-caption: :fire:
:warning-caption: :warning:
:stem: latexmath
endif::[]

[quote,Rich Hickey]
Simplicity is hard work. But, there's a huge payoff.

== Tool der Woche: wttr.in

Die Webanwendung wttr.in bietet eine einfache M√∂glichkeit die Temperatur f√ºr
bestimmte Orte anzeigen zu lassen. Die Einfachheit dieser Anwendung ist guter
Grund daf√ºr sie nutzen zu wollen.

Beispielaufrufe sieht so aus: `curl http://wttr.in/d√ºsseldorf` (klappt auch im
Browser) und liefert nette Ergebnisse.

Es gibt auch eine Hand voll von Standardformatierungen, die verwendet werden
k√∂nnen: 

   Œª curl http://wttr.in/d√ºsseldorf?format=3
   d√ºsseldorf: ‚õÖÔ∏è +16¬∞C

Die Hilfe finden Sie hier: http://wttr.in/:help

== Bendispostos B√§llchenbude

Im heutigen Projekt stellen wir Ihnen Bendispostos B√§llchenbude vor.
Diese Anwendung pr√ºft alle sechs Stunden, ob es √ºber 31¬∞C ist und verschickt
dann an alle Kund:innen eine E-Mail, damit sie zum Eis essen vorbeikommen.

Es gibt schon Klassen zum Versenden von Mails, Erstellen einer Kund:innendatenbank
sowie einer Abfrage, um die aktuelle Temperatur zu erfahren. Die Marketinglogik
befindet sich in `MarketingApp`.

Einige strukturelle Probleme haben sich hier eingeschlichen. Die Anwendung soll so umgeschrieben werden, dass die
Abh√§ngigkeiten lockerer sind und die Architektur grundlegend den SOLID Prinzipien gen√ºgt. Au√üerdem sollen Tests entwickelt werden.

=== Aufgaben

==== Analyse

Zun√§chst ein paar Gedanken vorab:

* Analysieren Sie die Anwendung und finden Sie strukturelle Probleme.
** Wie h√§ngen die Klassen zusammen? Ist das sinnvoll? Wie kann das gel√∂st werden?
** Wie w√ºrden Sie hier nun Tests entwickeln?
** Was m√ºsste am Projekt alles ver√§ndert werden, wenn wir einen anderen Anbieter als GMail verwenden wollen?

==== Dependency Injection

Wie Sie in Ihrer Analyse festgestellt haben, sind die einzelnen Klassen hart miteinander verdrahtet, was es uns quasi nicht m√∂glich macht Tests zu entwickeln (au√üer vielleicht mit einem Mocking-Framework). Daher wollen wir uns im ersten Schritt damit befassen diese Verdrahtung zu lockern.

* Schauen Sie sich den Konstruktor in der Klasse `MarketingApp` an und schreiben Sie ihn so um, dass die Abh√§ngigkeiten als Argumente √ºbergeben werden.

Das ist es schon grundlegend, was hinter Dependency Injection steckt üéâ

==== Dependency Inversion

In der Analyse haben Sie sicherlich ein paar Probleme festgestellt. L√∂sen Sie
diese, indem Sie die Klassenabh√§ngigkeiten mittels Dependency Inversion
umkehren.

√úberlegen Sie sich folgende Szenarien:

* Sie wollen einen alternativen Wetterdienst anbinden, um nicht von `wttr.in` abh√§ngig zu sein.
Der Code der `MarketingApp` soll aber unabh√§ngig vom Provider funktionieren.
* Zum Testen des Codes wollen wir einen eigenen Wetterdienst schreiben,
welcher sich deterministisch so verh√§lt, dass wir das Verhalten vorhersagen k√∂nnen.

WARNING: Schreiben Sie die Anwendung mittels Dependency Inversion um,
indem Sie die konkreten Klassen durch selbstgew√§hlte Interfaces ersetzen.
Nutzen Sie diese Interfaces dann in der Klasse `MarketingApp`.

==== Testing

Nutzen Sie die verbesserte Version des Projektes um Tests zu schreiben:

* Schreiben Sie einen Test, welcher pr√ºft, dass die Marketinganwendung keine E-Mails schreibt, wenn es zu kalt ist.
** Erstellen Sie hierzu eine Test-Wetter-Klasse und eine Test-E-Mail-Klasse, mit denen Sie das Verhalten √ºberpr√ºfen k√∂nnen.
* Schreiben Sie weitere Tests, die bei entsprechender Temperatur von √ºber 31 Grad Mails verschickt (Tipp: Ihre Test-E-Mail-Klasse muss gegebenenfalls die Anzahl der zu verschickenden Mails z√§hlen und als Zahl ausgeben.)
